================================================================================
ИНСТРУКЦИЯ ПО УСТАНОВКЕ И РАЗВЕРТЫВАНИЮ ПРОЕКТА SWEETHOME
================================================================================

Проект представляет собой информационную систему по управлению апартаментами,
построенную на Laravel 12 с использованием Vue.js 3.

================================================================================
ТРЕБОВАНИЯ К СИСТЕМЕ
================================================================================

1. PHP >= 8.2
2. Composer (последняя версия)
3. Node.js >= 18.x и npm
4. База данных: MySQL 8.0+ или PostgreSQL 13+ или SQLite
5. Веб-сервер: Apache или Nginx (для production) или встроенный сервер PHP (для разработки)

================================================================================
ШАГ 1: УСТАНОВКА ЗАВИСИМОСТЕЙ PHP
================================================================================

1. Откройте терминал/командную строку в корневой директории проекта

2. Установите зависимости PHP через Composer:
   
   composer install

   Если возникают проблемы, попробуйте:
   composer install --no-interaction

3. Убедитесь, что все зависимости установлены успешно

================================================================================
ШАГ 2: НАСТРОЙКА ОКРУЖЕНИЯ
================================================================================

1. Скопируйте файл .env.example в .env:
   
   Windows:
   copy .env.example .env
   
   Linux/Mac:
   cp .env.example .env

2. Откройте файл .env в текстовом редакторе и настройте следующие параметры:

   APP_NAME="SweetHome"
   APP_ENV=local (или production для продакшена)
   APP_KEY= (будет сгенерирован на следующем шаге)
   APP_DEBUG=true (для разработки) или false (для продакшена)
   APP_URL=http://localhost:8000

   Настройки базы данных:
   DB_CONNECTION=mysql (или pgsql, или sqlite)
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=sweethome
   DB_USERNAME=ваш_пользователь
   DB_PASSWORD=ваш_пароль

   Для SQLite:
   DB_CONNECTION=sqlite
   DB_DATABASE=/absolute/path/to/database/database.sqlite

   Настройки почты (для отправки уведомлений):
   MAIL_MAILER=smtp
   MAIL_HOST=smtp.mailtrap.io
   MAIL_PORT=2525
   MAIL_USERNAME=null
   MAIL_PASSWORD=null
   MAIL_ENCRYPTION=null
   MAIL_FROM_ADDRESS="noreply@sweethome.local"
   MAIL_FROM_NAME="${APP_NAME}"

   Настройки YooMoney (для платежей):
   YOOMONEY_URL=https://yoomoney.ru/checkout/payments/v2/contract
   YOOMONEY_SHOP_ID=ваш_shop_id
   YOOMONEY_SCENE_ID=ваш_scene_id
   YOOMONEY_API_KEY=ваш_api_key

   Настройки сессий:
   SESSION_DRIVER=file
   SESSION_LIFETIME=500

3. Сгенерируйте ключ приложения:
   
   php artisan key:generate

================================================================================
ШАГ 3: НАСТРОЙКА БАЗЫ ДАННЫХ
================================================================================

1. Создайте базу данных (если используете MySQL/PostgreSQL):
   
   MySQL:
   CREATE DATABASE sweethome CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   
   PostgreSQL:
   CREATE DATABASE sweethome;

2. Для SQLite убедитесь, что файл database/database.sqlite существует:
   
   Windows:
   type nul > database\database.sqlite
   
   Linux/Mac:
   touch database/database.sqlite

3. Выполните миграции базы данных:
   
   php artisan migrate

   Если нужно сбросить базу данных и создать заново:
   php artisan migrate:fresh

4. (Опционально) Заполните базу тестовыми данными:
   
   php artisan db:seed

================================================================================
ШАГ 4: УСТАНОВКА ЗАВИСИМОСТЕЙ NODE.JS
================================================================================

1. Установите зависимости Node.js:
   
   npm install

   Если возникают проблемы, попробуйте:
   npm install --legacy-peer-deps

2. Убедитесь, что все зависимости установлены успешно

================================================================================
ШАГ 5: НАСТРОЙКА ХРАНИЛИЩА
================================================================================

1. Создайте символическую ссылку для хранилища:
   
   php artisan storage:link

   Это необходимо для доступа к загруженным изображениям апартаментов.

================================================================================
ШАГ 6: СБОРКА FRONTEND РЕСУРСОВ
================================================================================

Для разработки (с hot-reload):
   npm run dev

Для продакшена:
   npm run build

После сборки файлы будут доступны в директории public/build

================================================================================
ШАГ 7: ЗАПУСК ПРИЛОЖЕНИЯ
================================================================================

ВАРИАНТ 1: Встроенный сервер PHP (для разработки)

1. Запустите сервер разработки:
   
   php artisan serve

2. Приложение будет доступно по адресу: http://localhost:8000

ВАРИАНТ 2: Использование Laravel Sail (Docker)

1. Установите Docker Desktop

2. Запустите контейнеры:
   
   ./vendor/bin/sail up -d

3. Приложение будет доступно по адресу: http://localhost

ВАРИАНТ 3: Настройка веб-сервера (Apache/Nginx)

Для Apache:
1. Создайте виртуальный хост, указывающий на директорию public проекта
2. Включите mod_rewrite
3. Убедитесь, что AllowOverride установлен в All для директории проекта

Для Nginx:
1. Создайте конфигурацию сервера, указывающую на директорию public проекта
2. Настройте обработку PHP через FastCGI
3. Убедитесь, что включена обработка try_files для SPA роутинга

Пример конфигурации Nginx:
   server {
       listen 80;
       server_name sweethome.local;
       root /path/to/project/public;
       
       add_header X-Frame-Options "SAMEORIGIN";
       add_header X-Content-Type-Options "nosniff";
       
       index index.php;
       
       charset utf-8;
       
       location / {
           try_files $uri $uri/ /index.php?$query_string;
       }
       
       location = /favicon.ico { access_log off; log_not_found off; }
       location = /robots.txt  { access_log off; log_not_found off; }
       
       error_page 404 /index.php;
       
       location ~ \.php$ {
           fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
           fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
           include fastcgi_params;
       }
       
       location ~ /\.(?!well-known).* {
           deny all;
       }
   }

================================================================================
ШАГ 8: СОЗДАНИЕ ПЕРВОГО АДМИНИСТРАТОРА
================================================================================

После установки создайте первого администратора через Tinker:

1. Запустите Tinker:
   
   php artisan tinker

2. Выполните следующие команды:
   
   $user = new App\Models\User();
   $user->name = 'Администратор';
   $user->email = 'admin@sweethome.local';
   $user->password = Hash::make('ваш_пароль');
   $user->role = 'admin';
   $user->save();

3. Выйдите из Tinker:
   
   exit

Теперь вы можете войти в систему с этими учетными данными и получить доступ
к панели администратора.

================================================================================
ШАГ 9: НАСТРОЙКА ОЧЕРЕДЕЙ (ОПЦИОНАЛЬНО)
================================================================================

Для обработки уведомлений и других фоновых задач настройте очередь:

1. В файле .env установите:
   
   QUEUE_CONNECTION=database

2. Создайте таблицы для очереди:
   
   php artisan queue:table
   php artisan migrate

3. Запустите воркер очереди:
   
   php artisan queue:work

   Или для постоянной работы в фоне:
   php artisan queue:listen

================================================================================
ШАГ 10: НАСТРОЙКА ИНТЕГРАЦИИ С YOOMONEY
================================================================================

1. Зарегистрируйтесь на https://yoomoney.ru/

2. Создайте магазин и получите:
   - Shop ID
   - Scene ID
   - API Key

3. Добавьте эти данные в файл .env:
   
   YOOMONEY_SHOP_ID=ваш_shop_id
   YOOMONEY_SCENE_ID=ваш_scene_id
   YOOMONEY_API_KEY=ваш_api_key

4. Настройте URL возврата в настройках магазина YooMoney:
   http://ваш_домен/payment/callback

================================================================================
ШАГ 11: НАСТРОЙКА КАРТЫ
================================================================================

Для отображения карты на странице деталей апартамента:

ВАРИАНТ 1: Google Maps
1. Получите API ключ на https://console.cloud.google.com/
2. Добавьте в .env:
   GOOGLE_MAPS_API_KEY=ваш_api_ключ

ВАРИАНТ 2: Yandex Maps
1. Получите API ключ на https://developer.tech.yandex.ru/
2. Добавьте в .env:
   YANDEX_MAPS_API_KEY=ваш_api_ключ

Примечание: В текущей версии используется Google Maps через iframe.
Для продакшена рекомендуется использовать API для лучшей производительности.

================================================================================
РЕШЕНИЕ ПРОБЛЕМ
================================================================================

ПРОБЛЕМА: Ошибка "Class not found"
РЕШЕНИЕ: Выполните composer dump-autoload

ПРОБЛЕМА: Ошибка "Permission denied" при записи в storage
РЕШЕНИЕ: Установите права на запись:
   Windows: Проверьте права доступа к папке
   Linux/Mac: chmod -R 775 storage bootstrap/cache

ПРОБЛЕМА: Страницы не загружаются (404)
РЕШЕНИЕ: 
   1. Убедитесь, что mod_rewrite включен (Apache)
   2. Проверьте конфигурацию веб-сервера
   3. Выполните: php artisan route:clear
   4. Выполните: php artisan config:clear

ПРОБЛЕМА: Vue компоненты не загружаются
РЕШЕНИЕ:
   1. Убедитесь, что выполнили npm install
   2. Выполните npm run build или npm run dev
   3. Очистите кэш: php artisan cache:clear

ПРОБЛЕМА: Ошибки CSRF токена
РЕШЕНИЕ:
   1. Убедитесь, что в layout есть meta тег с CSRF токеном
   2. Проверьте настройки сессий в .env
   3. Очистите кэш сессий: php artisan session:clear

ПРОБЛЕМА: Изображения не отображаются
РЕШЕНИЕ:
   1. Выполните: php artisan storage:link
   2. Проверьте права доступа к storage/app/public
   3. Убедитесь, что изображения загружены в storage/app/public

================================================================================
СТРУКТУРА ПРОЕКТА
================================================================================

app/
  Http/
    Controllers/          - Контроллеры приложения
    Middleware/          - Промежуточное ПО
  Models/                - Модели Eloquent
  Mail/                  - Классы для отправки почты

database/
  migrations/            - Миграции базы данных
  seeders/              - Сидеры для заполнения данных

public/
  build/                - Собранные frontend ресурсы
  images/               - Статические изображения (логотип и т.д.)
  storage/              - Символическая ссылка на storage/app/public

resources/
  js/
    components/         - Vue компоненты
      common/           - Общие компоненты
      layouts/         - Компоненты макетов
      pages/           - Страницы приложения
        admin/        - Страницы администратора
        user/         - Страницы пользователя
    router/            - Конфигурация Vue Router
    App.vue            - Главный компонент Vue
    app.js             - Точка входа JavaScript
  css/
    app.css            - Глобальные стили
  views/
    app.blade.php      - Главный шаблон Blade

routes/
  web.php              - Веб-маршруты
  api.php              - API маршруты

storage/
  app/
    public/            - Загруженные файлы (изображения апартаментов)
  logs/                - Логи приложения

================================================================================
ВАЖНЫЕ КОМАНДЫ
================================================================================

Очистка кэша:
   php artisan cache:clear
   php artisan config:clear
   php artisan route:clear
   php artisan view:clear

Оптимизация для продакшена:
   php artisan config:cache
   php artisan route:cache
   php artisan view:cache

Запуск тестов:
   php artisan test

Просмотр маршрутов:
   php artisan route:list

Просмотр логов:
   tail -f storage/logs/laravel.log (Linux/Mac)
   type storage\logs\laravel.log (Windows)

================================================================================
БЕЗОПАСНОСТЬ
================================================================================

1. В продакшене установите APP_DEBUG=false
2. Используйте сильные пароли для базы данных
3. Настройте HTTPS для защиты данных
4. Регулярно обновляйте зависимости:
   composer update
   npm update
5. Ограничьте доступ к файлу .env
6. Настройте файрвол для базы данных

================================================================================
ПОДДЕРЖКА
================================================================================

При возникновении проблем:
1. Проверьте логи: storage/logs/laravel.log
2. Проверьте документацию Laravel: https://laravel.com/docs
3. Проверьте документацию Vue.js: https://vuejs.org/

================================================================================
ЛИЦЕНЗИЯ
================================================================================

Проект создан для внутреннего использования.

================================================================================
КОНЕЦ ИНСТРУКЦИИ
================================================================================

